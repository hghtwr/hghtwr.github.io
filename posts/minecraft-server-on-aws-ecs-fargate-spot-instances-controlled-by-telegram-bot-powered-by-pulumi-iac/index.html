<!doctype html><html lang=en><head><title>Minecraft Server on AWS ECS Fargate Spot instances controlled by Telegram Bot, powered by Pulumi IaC Â· Johannes Sonner (Hightower)
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Johannes Sonner"><meta name=description content="Platform Engineering is basically like Minecraft. You carefully craft the best possible solution in a world with unlimited possibilities, only for some thing to blow up and ruin your day. Then you rebuild and create something even more awesomeâ€¦
And as in real world, the fun starts, once you work together with other people. Hosting an own server requires either a rather high commitment to some public hosting provider (at least if you only play from time to time, like me) or to self-host your server with all the caveats attached."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Minecraft Server on AWS ECS Fargate Spot instances controlled by Telegram Bot, powered by Pulumi IaC"><meta name=twitter:description content="Platform Engineering is basically like Minecraft. You carefully craft the best possible solution in a world with unlimited possibilities, only for some thing to blow up and ruin your day. Then you rebuild and create something even more awesomeâ€¦
And as in real world, the fun starts, once you work together with other people. Hosting an own server requires either a rather high commitment to some public hosting provider (at least if you only play from time to time, like me) or to self-host your server with all the caveats attached."><meta property="og:url" content="https://hghtwr.github.io/posts/minecraft-server-on-aws-ecs-fargate-spot-instances-controlled-by-telegram-bot-powered-by-pulumi-iac/"><meta property="og:site_name" content="Johannes Sonner (Hightower)"><meta property="og:title" content="Minecraft Server on AWS ECS Fargate Spot instances controlled by Telegram Bot, powered by Pulumi IaC"><meta property="og:description" content="Platform Engineering is basically like Minecraft. You carefully craft the best possible solution in a world with unlimited possibilities, only for some thing to blow up and ruin your day. Then you rebuild and create something even more awesomeâ€¦
And as in real world, the fun starts, once you work together with other people. Hosting an own server requires either a rather high commitment to some public hosting provider (at least if you only play from time to time, like me) or to self-host your server with all the caveats attached."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-23T01:26:50+01:00"><link rel=canonical href=https://hghtwr.github.io/posts/minecraft-server-on-aws-ecs-fargate-spot-instances-controlled-by-telegram-bot-powered-by-pulumi-iac/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.aa5ef26fa979d6793724ae2dbd71efa94fd16cb1c5c7db3b6651f21f9892a5fd.css integrity="sha256-ql7yb6l51nk3JK4tvXHvqU/RbLHFx9s7ZlHyH5iSpf0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://hghtwr.github.io/>Johannes Sonner (Hightower)
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/pages/about-me/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://hghtwr.github.io/posts/minecraft-server-on-aws-ecs-fargate-spot-instances-controlled-by-telegram-bot-powered-by-pulumi-iac/>Minecraft Server on AWS ECS Fargate Spot instances controlled by Telegram Bot, powered by Pulumi IaC</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-03-26T00:00:00Z>March 26, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
8-minute read</span></div></div></header><div class=post-content><p><img alt=Intro src=/posts/minecraft-server-on-aws-ecs-fargate-spot-instances-controlled-by-telegram-bot-powered-by-pulumi-iac/intro.webp></p><blockquote><p>Platform Engineering is basically like Minecraft. You carefully craft the best possible solution in a world with unlimited possibilities, only for some thing to blow up and ruin your day. Then you rebuild and create something even more awesomeâ€¦</p></blockquote><p>And as in real world, the fun starts, once you work together with other people. Hosting an own server requires either a rather high commitment to some public hosting provider (at least if you only play from time to time, like me) or to self-host your server with all the caveats attached.</p><p>So, we need some solution that</p><ul><li>hosts a minecraft server on-demand,</li><li>can be controlled by multiple players,</li><li>is affordable and</li><li>requires as less work as possible to setup & maintain.</li></ul><h1 id=concept>Concept
<a class=heading-link href=#concept><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Letâ€™s try to come up with a solution for this problem.</p><p><img alt=Concept src=/posts/minecraft-server-on-aws-ecs-fargate-spot-instances-controlled-by-telegram-bot-powered-by-pulumi-iac/concept.webp></p><p>We will host the server on AWS ECS Fargate, the managed container runtime offered by AWS. A telegram bot that is calling a lambda function with a webhook will trigger scaling to start and stop the server. By reading log events, we can give feedback to the users in telegram, e.g. when the server is ready to accept connections. The data for the server is stored in AWS Elastic File System (EFS). To import/export world data, we can use S3 Datasync to synchronize the EFS with a S3 bucket.</p><p>All of this, we will set up with Pulumi, my favourite IaC (Infrastructure-as-code) solution that allows us to define our infrastructure in different programming languages (I will use Typescript here). Optionally, you can use free Pulumi Cloud to store the state of your infrastructure and environment variables or secrets.</p><blockquote><p>Talk is cheap! How much will this server cost me??</p></blockquote><p>Most of this solution is covered by AWS Free Tier. You will have to pay a small fee for the ECS Runtime while the server is running. Spot Instances allow you to use spare compute capacity by AWS. With this I made a test and running this server was 0,63$ per day for 1 vCPU & 8 GB RAM. Interestingly, it was never interrupted until now, and even if it would be, the server has enough time to grafecully shut down.</p><p>Letâ€™s start! You skip the talk and directly go to the <a href=https://github.com/hghtwr/minecraft-ecs-telegram class=external-link target=_blank rel=noopener>git repository</a>.</p><h1 id=prerequisites>Prerequisites
<a class=heading-link href=#prerequisites><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>You will need a few things:</p><ul><li>An AWS Account with free tier which you can set up here.</li><li>A Pulumi cloud account you can setup here. Alternatively, you can find plenty of info how to store your state in a S3 bucket, if you donâ€™t want to use cloud.</li><li>Pulumi CLI, Pulumi ESC & AWS CLI installed on your computer.</li></ul><h1 id=setup-telegram-bot--get-chat-id>Setup Telegram Bot & Get chat id
<a class=heading-link href=#setup-telegram-bot--get-chat-id><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Unfortunately, you will have to start with a manual step and create a new telegram bot using BotFather as described in the telegram docs. Make sure to copy the api token you receive.</p><blockquote><p>But you said we will do everything automatically!?</p></blockquote><p>Well, reality hits. If you find a way to create a bot without interacting manually with the BotFather, let me know. We can also automate API calls with Pulumi, more on this later ðŸ˜Ž.</p><p>After you added this bot to a chatgroup, we can extract the chat id. Later we will use this to restrict access to our control commands to this chat group only. You donâ€™t want the whole world to interact with your minecraft server!</p><p>To do this, add the bot to the group and send a message. Afterwards, use the <a href=https://core.telegram.org/bots/api#getupdates class=external-link target=_blank rel=noopener>GetUpdates</a> endpoint of the telegram API and extract the chat id.</p><h1 id=optional-set-up-pulumi-esc-environments-secrets--configuration>Optional: Set up Pulumi ESC (Environments, Secrets & Configuration)
<a class=heading-link href=#optional-set-up-pulumi-esc-environments-secrets--configuration><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>You can skip this step and store the chat id and api token simply as shell environment variable, using your preferred method (e.g. direnv). Nevertheless, I like Pulumi ESC as I have secure access to the values even if Iâ€™m on another machine (you obviously donâ€™t want to check them in into your git repository).</p><p>Pulumi ESC allows us to store the configuration, secrets and environment details in Pulumi Cloud and get them during local execution of our pulumi program. Simply head over to their cloud, create a new environment and paste the values from the previous step into this environment. We will use it only for the chat id and api token. The rest of our configuration stays in Git as I simply prefer to have everything in Git, if possible. The built-in function for secrets will make sure that the value is stored as ciphertext.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># See https://www.pulumi.com/docs/esc/reference/ for additional examples.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># values is a required top-level key</span>
</span></span><span style=display:flex><span><span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>telegram</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>chatId</span>: <span style=color:#ae81ff>&lt;chatId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>apiToken</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>fn::secret</span>: <span style=color:#ae81ff>&lt;apiToken&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># ---------------------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Exports -- expose configuration values to particular consumers</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># ---------------------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Configuration nested under the &#34;environmentVariables&#34; key is used to export environment</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># variables when using `esc open --format shell`, `esc run`, or `pulumi up/preview/refresh/destroy`</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>environmentVariables</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>TELEGRAM_API_TOKEN</span>: <span style=color:#ae81ff>${telegram.apiToken}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>TELEGRAM_CHAT_ID</span>: <span style=color:#ae81ff>${telegram.chatId}</span>
</span></span></code></pre></div><p>Now, import these environment variables to your shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>eval <span style=color:#66d9ef>$(</span>esc env open &lt;pulumiorg&gt;/&lt;environment-name&gt; --format shell<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>By the way, you can also use this method, to store your AWS Access Key ID & Secret in your Pulumi cloud environment. If you have a paid version of Pulumi Cloud, you can use an Organization to share this access key between multiple developers (if you should do this, is another questionâ€¦).</p><h1 id=pulumi-comes-into-action>Pulumi comes into action
<a class=heading-link href=#pulumi-comes-into-action><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>To begin, clone the git repository. You can start customizing your server instance using the Pulumi.*.yaml files. Each of these files represents one stack, means one installation of this program. First select a stack, then run a preview or directly install all the infrastructure in one go.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>~/minecraft-ecs-telegram$ npm install <span style=color:#75715e>## First install the dependencies for pulumi</span>
</span></span><span style=display:flex><span>~/minecraft-ecs-telegram$ pulumi stack <span style=color:#66d9ef>select</span> dev <span style=color:#75715e># Will select Pulumi.dev.yaml</span>
</span></span><span style=display:flex><span>~/minecraft-ecs-telegram$ pulumi preview <span style=color:#75715e>## Will show you what will be installed </span>
</span></span><span style=display:flex><span>~/minecraft-ecs-telegram$ pulumi up <span style=color:#75715e>## And let&#39;s go :) </span>
</span></span></code></pre></div><p>I will not explain all the source code in detail, itâ€™s quite boring. You can check out their very good <a href=https://www.pulumi.com/docs/ class=external-link target=_blank rel=noopener>documentation</a> instead. I will only highlight some ideas.</p><h2 id=1-lambda-setup>1. Lambda Setup
<a class=heading-link href=#1-lambda-setup><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Using a <code>Makefile</code> we can automatically create .zip files from our lambda code to be uploaded. Donâ€™t forget to run make build when you change something in the handlers. This is quite convenient. The telegram bot handlers are written in python, using telebot. Telegram bots are originally designed to listen to a specific port. With lambda, we need an invocation. Therefore, we change the telegram bot to trigger a webhook when receiving a command. And because Pulumi is awesome, we can do this rather easily. We can automatically issue an API call to the Telegram API with the lambda invocation url to be set as webhook for incoming messages ðŸ˜Ž.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>telegramWebhook</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>local</span>.<span style=color:#a6e22e>Command</span>(<span style=color:#e6db74>&#34;telegram-webhook&#34;</span>, {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>triggers</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>mcTelegramBot</span>.<span style=color:#a6e22e>commandHandlerFunctionUrl</span>.<span style=color:#a6e22e>functionUrl</span>],
</span></span><span style=display:flex><span><span style=color:#a6e22e>create</span>: <span style=color:#66d9ef>pulumi.interpolate</span> <span style=color:#e6db74>`curl --data </span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>&#34;url=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>mcTelegramBot</span>.<span style=color:#a6e22e>commandHandlerFunctionUrl</span>.<span style=color:#a6e22e>functionUrl</span><span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>&#34; https://api.telegram.org/bot</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>TELEGRAM_API_TOKEN</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/setWebhook`</span>
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>webhookResult</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>telegramWebhook</span>.<span style=color:#a6e22e>stdout</span>;
</span></span></code></pre></div><p>All of this allow us to enable lambda to react to messages sent to the bot, e.g. /start to start our server.</p><h2 id=2-pulumi-configs--defaults>2. Pulumi Configs & Defaults
<a class=heading-link href=#2-pulumi-configs--defaults><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Pulumiâ€™s stack files allow us to define configuration values for our setup. In index.ts , we translate these to the class interface for the ECS class options ( McEcsOptions ). This allows us to use a programmatic approach to seperate concerns into different classes (even different npm packages, if necessary, btw ). Using the config object by Pulumi, we have multiple possibilities, to make configuration items mandatory and certain types. Furthermore, we can then later define default options which we merge into the options provided by the user. This means, the user can override these values easily but still it will also default to reasonable values (see ecs.ts ).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>McEcs</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>ComponentResource</span> {
</span></span><span style=display:flex><span>[...]
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>McEcsOptions</span>, <span style=color:#a6e22e>opts</span>: <span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#e6db74>&#34;awsmc:ecs:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>opts</span>);
</span></span><span style=display:flex><span>    [...]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>defaultOptions</span>: <span style=color:#66d9ef>McEcsOptions</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>image</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;itzg/minecraft-server&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cpu</span>: <span style=color:#66d9ef>256</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>memory</span>: <span style=color:#66d9ef>512</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>useSpotInstance</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>serverProperties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>MODT</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Welcome to Minecraft&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>DIFFICULTY</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;normal&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>GAME_MODE</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;survival&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>ONLINE_MODE</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;TRUE&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>SERVER_NAME</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Minecraft Server&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Merging together the default options with the user provided options
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mcEcsOptions</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>lodash</span>.<span style=color:#a6e22e>merge</span>(<span style=color:#a6e22e>defaultOptions</span>, <span style=color:#a6e22e>args</span>);
</span></span></code></pre></div><h2 id=3-use-log-subscription-filters-to-react-to-log-messages>3. Use Log Subscription filters to react to log messages
<a class=heading-link href=#3-use-log-subscription-filters-to-react-to-log-messages><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>We can easily detect changes in our server by using CloudWatchâ€™s LogSubscriptionFilter. So we simply listen to certain log messages to trigger a lambda function to send a message to the telegram chat about our server. We will send the IP of the server, once itâ€™s ready and tell the user itâ€™s shut down when itâ€™s stopped.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>readinessLogSubscriptionFilter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>cloudwatch</span>.<span style=color:#a6e22e>LogSubscriptionFilter</span>(<span style=color:#e6db74>&#34;readinessLogSubscriptionFilter&#34;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logGroup</span>: <span style=color:#66d9ef>this.lambdaOptions.readinessLogGroup</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filterPattern</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;%RCON running on 0\\.0\\.0\\.0:25575%&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>destinationArn</span>: <span style=color:#66d9ef>this.readinessHandler.arn</span>,
</span></span><span style=display:flex><span>    }, { <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>dependsOn</span><span style=color:#f92672>:</span> [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>readinessHandler</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>allowCloudWatchReadiness</span>]});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stoppedLogSubscriptionFilter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>cloudwatch</span>.<span style=color:#a6e22e>LogSubscriptionFilter</span>(<span style=color:#e6db74>&#34;stoppedLogSubscriptionFilter&#34;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logGroup</span>: <span style=color:#66d9ef>this.lambdaOptions.readinessLogGroup</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filterPattern</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;%Thread RCON Listener stopped%&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>destinationArn</span>: <span style=color:#66d9ef>this.stoppedHandler.arn</span>,
</span></span><span style=display:flex><span>    }, { <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>dependsOn</span><span style=color:#f92672>:</span> [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stoppedHandler</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>allowCloudWatchStopped</span>]});
</span></span></code></pre></div><h2 id=4-spot-instance-support>4. Spot Instance Support
<a class=heading-link href=#4-spot-instance-support><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Pulumiâ€™s programmatic approach also allows us to easily implement spot instance support. For this we simply use a configuration value to set the corresponding CPU Architecture (Spots only work with x86) and capacity provider.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>taskDefinition</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>ecs</span>.<span style=color:#a6e22e>TaskDefinition</span>(<span style=color:#e6db74>&#34;taskdefinition&#34;</span>, {
</span></span><span style=display:flex><span>    [...]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>networkMode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;awsvpc&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>runtimePlatform</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>operatingSystemFamily</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;LINUX&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cpuArchitecture</span>: <span style=color:#66d9ef>this.mcEcsOptions.useSpotInstance</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;X86_64&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ARM64&#34;</span>, <span style=color:#75715e>// Graviton is cheaper but only available for non-spot instances
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    },
</span></span><span style=display:flex><span>    [...]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>capacityProvider</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mcEcsOptions</span>.<span style=color:#a6e22e>useSpotInstance</span> <span style=color:#f92672>?</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>capacityProvider</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;FARGATE_SPOT&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>weight</span>: <span style=color:#66d9ef>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>base</span>: <span style=color:#66d9ef>0</span>,
</span></span><span style=display:flex><span>  } <span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>capacityProvider</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;FARGATE&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>weight</span>: <span style=color:#66d9ef>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>base</span>: <span style=color:#66d9ef>1</span>,
</span></span><span style=display:flex><span>  };
</span></span></code></pre></div><h2 id=5-datasync>5. DataSync
<a class=heading-link href=#5-datasync><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The programm will automatically create DataSync tasks to move your data to the server. Simply to the DataSync service, select tasks, select the right task and drop your files into the according S3 bucket. Try to keep the number of syncs down, as it will cost money.</p><h1 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>All in all, itâ€™s pretty simple, right? Itâ€™s straight forward and the chat group allows you and your friends to operate the server anytime from any place. The setup on AWS is reliable, cheap and easy to work with.</p><blockquote><p>WARNING! I highly recommend to set a billing alarm, just in case!</p></blockquote></div><footer></footer></article></section></div><footer class=footer><section class=container>Â©
2025
Johannes Sonner
Â·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-8QE7N3YHJ3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8QE7N3YHJ3")</script></body></html>